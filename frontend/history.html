<!doctype html>
<html>
<head><meta charset="utf-8"><title>History</title><link rel="stylesheet" href="style.css"></head>
<body>
  <div style="max-width:900px;margin:40px auto;">
    <h2>Your History</h2>
    <div id="historyList">Loading...</div>
    <p><a href="dashboard.html">← Back</a></p>
  </div>

<script>
(async function(){
  // Require login
  if (localStorage.getItem('cc_logged_in') !== '1') {
    window.location.href = 'login.html';
    return;
  }

  const container = document.getElementById('historyList');
  try {
    // If you created backend endpoint /api/history (FastAPI example), call it:
    const res = await fetch('http://localhost:8000/api/history'); // update host/port if needed
    if (!res.ok) { container.textContent = 'Failed to load history'; return; }
    const data = await res.json();

    if (!data || data.length === 0) {
      container.innerHTML = '<p>No analyses yet — run an analysis first.</p>';
      return;
    }

    container.innerHTML = '';
    data.forEach(item => {
      const el = document.createElement('div');
      el.className = 'history-card';
      el.style.marginBottom='12px';
      el.innerHTML = `
         <div style="border:1px solid #ddd;padding:12px;border-radius:8px;">
           <div><strong>ID:</strong> ${item.session_id} — <em>${new Date(item.timestamp).toLocaleString()}</em></div>
           <div><strong>Fit:</strong> ${item.fit_score ?? 'N/A'}</div>
           <div><strong>Best job:</strong> ${item.best_suited_job ?? 'N/A'}</div>
           <details><summary>Resume preview</summary><pre style="white-space:pre-wrap">${item.resume_preview}</pre></details>
           <details><summary>Job description preview</summary><pre style="white-space:pre-wrap">${item.jd_preview}</pre></details>
         </div>
      `;
      container.appendChild(el);
    });

  } catch (err) {
    console.error(err);
    container.textContent = 'Error loading history (check backend is running).';
  }
})();
</script>
</body>
</html>
